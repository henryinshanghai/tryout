fact: ä½¿ç”¨JSPé¡µé¢ä½œä¸º Web UIï¼Œæ˜¯ä½¿ç”¨Javaå¼€å‘Webåº”ç”¨æ—¶å¸¸è§çš„é€‰æ‹©ï¼ˆå¾ˆå¤šå¹´å‰ï¼‰ã€‚
å¦‚æœå¼€å‘è€…æƒ³è¦ åœ¨JSPä¸­ä½¿ç”¨ Jstl(JSP Standard Tag Library) æ¥ å¢å¼º JSPçš„åŠŸèƒ½ã€‚
åˆ™ï¼šå°±éœ€è¦åœ¨ Spring MVCä¸­ä½¿ç”¨ JstlViewæ¥ä½œä¸º Viewå¯¹è±¡ - è¿›è€Œå‘ˆç°æ•°æ®ã€‚

--- render() in AbstractView ---
ä½œç”¨ï¼šä¸ºæŒ‡å®šçš„model æ¥ å‡†å¤‡viewã€‚
ç‰¹å¾ï¼š
    #1 å¦‚æœæœ‰å¿…è¦ï¼Œåˆ™ æŠŠå®ƒä¸é™æ€å±æ€§ ä¸ RequestContextå±æ€§åˆå¹¶åˆ°ä¸€èµ·ã€‚
    #2 çœŸæ­£çš„æ¸²æŸ“å·¥ä½œï¼Œä¼šå§”æ‰˜ç»™ renderMergedOutputModel
    #3 JstlViewä¸­æ²¡æœ‰å®ç° render()æ–¹æ³• - å› æ­¤ä½¿ç”¨çš„render()æ–¹æ³• å…¶å®æ˜¯ç”±å®ƒçš„åŸºç±»ï¼ˆAbstractViewï¼‰æ‰€æä¾›çš„ã€‚

å…³é”®ä»£ç ï¼š
public void render(@Nullable Map<String, ?> model, HttpServletRequest request,
        HttpServletResponse response) throws Exception {

    if (logger.isDebugEnabled()) {
        logger.debug("View " + formatViewName() +
                ", model " + (model != null ? model : Collections.emptyMap()) +
                (this.staticAttributes.isEmpty() ? "" : ", static attributes " + this.staticAttributes));
    }

    // æŠŠæ‰€æœ‰çš„ç›¸å…³ä¿¡æ¯ éƒ½æ±‡é›†åˆ°ä¸€ä¸ªMapä¸­
    Map<String, Object> mergedModel = createMergedOutputModel(model, request, response);
    prepareResponse(request, response);
    // æŠŠæ¨¡å‹æ•°æ® å±•ç¤ºåˆ° è§†å›¾ä¸­çš„æ–¹æ³•
    renderMergedOutputModel(mergedModel, getRequestToExpose(request), response);
}

-- renderMergedOutputModel() in AbstractView --
ç‰¹å¾ï¼šå­ç±»å¿…é¡»å®ç°è¿™ä¸ªæ–¹æ³• æ¥ çœŸæ­£åœ°æ¸²æŸ“viewã€‚
å®ç°æ­¥éª¤ï¼š
#1 å‡†å¤‡è¯·æ±‚ï¼šå¯¹äºJSPçš„æƒ…å†µï¼Œè¿™æ„å‘³ç€ æŠŠ modelå¯¹è±¡è®¾ç½®ä¸º è¯·æ±‚çš„å±æ€§ï¼›
#2 çœŸæ­£åœ°æ¸²æŸ“è§†å›¾ï¼Œæ¯”å¦‚è¯´ é€šè¿‡ä¸€ä¸ª RequestDispatcher æ¥ åŒ…å«JSPã€‚

-- InternalResourceView å¯¹ renderMergedOutputModel()çš„å®ç° --
ä½œç”¨ï¼šä¸ºç»™å®šçš„model æ¥ æ¸²æŸ“å†…éƒ¨çš„èµ„æºã€‚
ç‰¹å¾ï¼šè¿™åŒ…æ‹¬ æŠŠmodelè®¾ç½®ä¸º requestçš„å±æ€§ã€‚

ä»£ç å®ç°ï¼š
protected void renderMergedOutputModel(
        Map<String, Object> model, HttpServletRequest request, HttpServletResponse response) throws Exception {

    // æŠŠmodelå¯¹è±¡ æš´éœ²ä¸º requestçš„å±æ€§
    exposeModelAsRequestAttributes(model, request);

    // å¦‚æœå­˜åœ¨æœ‰helperå¯¹è±¡çš„è¯ï¼ŒæŠŠå®ƒä¹Ÿæš´éœ²ä¸º requestsçš„å±æ€§
    exposeHelpers(request);

    // ä¸ºè¯·æ±‚å§”æ´¾å™¨ å†³å®šå…·ä½“çš„è·¯å¾„
    String dispatcherPath = prepareForRendering(request, response);

    // ä¸ºç›®æ ‡resourceï¼ˆä¸€èˆ¬æ¥è¯´æ˜¯ JSPï¼‰æ¥ è·å–åˆ°ä¸€ä¸ª RequestDispatcher
    RequestDispatcher rd = getRequestDispatcher(request, dispatcherPath);
    if (rd == null) {
        throw new ServletException("Could not get RequestDispatcher for [" + getUrl() +
                "]: Check that the corresponding file exists within your web application archive!");
    }

    // å¦‚æœå·²ç»åŒ…å«äº† æˆ–è€… å“åº”å·²ç»è¢«æäº¤äº†ï¼Œåˆ™ï¼šæ‰§è¡Œ includeã€‚å¦åˆ™ æ‰§è¡Œ forward
    if (useInclude(request, response)) {
        response.setContentType(getContentType());
        if (logger.isDebugEnabled()) {
            logger.debug("Including [" + getUrl() + "]");
        }
        rd.include(request, response);
    }

    else {
        // ğŸ– forwardedçš„èµ„æº åº”è¯¥ è‡ªè¡Œå†³å®šå®ƒçš„ content type
        if (logger.isDebugEnabled()) {
            logger.debug("Forwarding to [" + getUrl() + "]");
        }
        rd.forward(request, response);
    }
}

ä»£ç åˆ†æï¼š
#1 å¯¹æ¨¡å‹æ•°æ®è¿›è¡Œå¤„ç†ï¼›
    ç‰¹å¾ï¼š
        #1 åœ¨exposeModelAsRequestAttributes()ä¸­å®ç°çš„ï¼›
        #2 å®ƒæ˜¯ä¸€ä¸ªè®¾è®¡åœ¨ AbstractViewä¸­çš„æ–¹æ³•ï¼›
            ä½œç”¨ï¼šæŠŠ ModelAndViewä¸­çš„æ¨¡å‹æ•°æ® & å…¶ä»–çš„è¯·æ±‚æ•°æ® éƒ½æ”¾åœ¨ HttpServletRequestçš„å±æ€§ä¸­å» - è¿™æ ·å°±èƒ½æ–¹ä¾¿åœ°ä½¿ç”¨è¿™äº›æ•°æ®äº†


