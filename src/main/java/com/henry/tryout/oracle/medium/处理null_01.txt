在这一集中，我们将会 向未知领域迈出一步 是时候讨论 null了

null 是缺失或者不适用信息的“占位符”
它的发明者 托尼 霍尔博士 曾将其 描述为 数十亿美元的错误

为什么？
因为使用它 会给你的代码 带来巨大的复杂性

如果没有null，那么
当你在比较两个值的时候，结果要么为真，要么为假

比如，这两个玩具的颜色相同吗？是的，这是真的
这两个玩具的重量相同吗? 不是的，这是false

但是null引入了第三种状态：未知

那么当你使用它的时候 会发生什么呢？
要制作我们可爱的玩具，我们 需要知道 在它们里面放入多少填充物 才能让它们抱起来软软乎乎的。
但是 填充物 对于积木块来说 是无效的属性

我们将它们存储在同一个表中，那么
在积木块的填充物列中 应该放入什么数值呢？
我们可以使用0，但这么做 其实并不正确，因为 填充物 对于积木块来说 是无效属性
我们可以做的是 说该属性“不适用”, 并 为此属性填充 null值

但这让你在编写SQL时很头疼，因为 SQL语句 只处理那些 “where子句为真的行”。
如果 结果为false 或者 unknown的话，那么 数据库不会处理它

现在如果我们问 企鹅 是否与积木块 有相同数量的填充物？
这么提问 是讲得通的，显然 答案是 没有
所以 SQL不返回 是没有问题的。

但是 让我们问一个 不同的问题：
企鹅的填充物 是否 比积木块 更多呢?
直觉上来看，答案是肯定的。因为 企鹅有填充物，而积木块没有。

但是如果我们说 这个值是否大于null，答案会是 unknown，所以不会返回该行

你可以通过使用 is null 来 解决这个问题。
除了检查 企鹅填充物的质量 是否 大于 积木块填充物的质量，
你还需要检查 企鹅填充物为非null 而 积木块填充物为null的情形。
这样做，你就会得到 正确的答案

但是 如果你要比较很多列的话，这样做很快就会使 你的SQL变得非常复杂。
你可以通过 将空值 -> 实际值 来简化此操作

“NVL”是Oracle所提供的一个函数，
如果函数的第一个参数为null，它就会返回第二个参数。
所以 你可以使用它来 把填充量映射为0. 这样你就能够 正确地对列进行比较了

select *
from penguins p
join bricks b
on nvl(p.quantity_of_stuffing, 0) >
    nvl(b.quantity_of_stuffing, 0);

或者 你也可以使用 符合ANSI标准的 “coalesce”，
它与nvl有一些细微的差异，但关键在于 coalesce可以接受任意数量的参数，
而nvl只能够接收两个参数

还有许多其他 与null相关的函数可用，使用它们 可以更轻松地处理这些值。
但是无论你做什么，你的SQL都会更复杂，而且你也更容易出错
所以 或许托尼霍尔爵士 是对的，null 导致了价值10亿美元的错误，所以 我们最好避免它。
但你具体能做些什么呢?

== 魔法数字 ==
为了避免使用null，许多人使用 魔法数字 来代替
它们是 特殊的越界值，在实际数据中 是不可能存在的

比如，积木块的填充量 不可能是负数，
所以如果此属性“不适用”的话，我们可以 把积木块的填充量 存储为-1。

乍一看，这样做好像解决了null的问题。
如果我们比较 企鹅的填充量 与 积木块的填充量，我们又回到了 标准的二值逻辑。
我们得到了期望的结果

但是，使用魔法数字 会给其他地方的代码 带来复杂性，
比如，如果我们想要 汇总用于所有玩具的填充量的总和，
你会为桌子上的每个积木块都-1，从而给出错误的答案。
其他的聚合函数（比如 平均值、标准差等）也存在类似问题

虽然对此的解决方案很简单，只需要添加 不包括魔法数字的where子句 - 但这很容易被忘记
特别是 如果它们很少 或者 它们看起来 像是数据中的真实值
因此，加入你团队的新开发人员 可能不知道 这些值 具有特殊含义，
你需要告诉 加入你团队的每个人 你的魔法数字是什么，以及它们是如何工作的，
这样 你的应用程序 才能正常运行

至少null是公开记录的，并且 在不同的系统中 以相同的方式工作
你还需要 确保 你的“不可能的魔法数字” 真的不可能出现

1979年，Robert 申请了一个个性化车牌
并把他的前两个选择 填写为 “SAILING” 和 “BOATING”，
他自己并没有第三个选择，但他没有在表格中 空出这一行，而是输入了 NO PLATE
事实证明，前两个选择都已经被使用了，因此
机动车辆部门 向他颁发了 包含文本“NO PLATE”的车牌，
所以 他最终得到了 他并不真正想要的 个性化车牌。
但是问题 还不止于此，
事实上，当停车官员 为非法停车的车辆 开罚单时，如果车辆 还没有车牌的话，那么
它们就会被登记为“NO PLATE”。
当这些罚单被处理 并 输入系统中时，它们会与 Robert的车牌 相匹配，
所以很快 他就开始收到 来自全国各地的 大量停车罚单。

请记住，如果你的魔法数字 有可能成为 真正有效的值，
那么 与你一开始就是用null 相比，你可能会出现 新的甚至更加奇怪的错误。
使用魔法数字时 要格外小心！

处理null是一个棘手的问题，我们在这里介绍了一些关键点，
但正如 我们将在后面的课程中 所发现的那样，
大多数SQL操作 在使用null的时候，都会有 自己的注意事项。

通过仔细的表设计 可以减少 你对使用null的需要，
对于 应该具有实际值的所有列，请确保 你为它们添加了 NOT NULL的约束，
这将会 防止null值 意外地进入 你的数据中。

但是处理“缺失或者不适用的信息” 是一个永远不会 真正消失的问题，
不管你选择使用null 还是 魔法数字 来应对，
请确保 在测试应用程序时，包含具有这些属性的行。

以上是 Oracle数据库中 关于null的快速概览，
希望你喜欢，但更重要的是，希望你学习到了一些东西

如果你觉得这有用，并且喜欢我的风格的话，订阅以学习更多