// éªŒè¯ï¼šç¬¬4æ¬¡ å…ƒç´ å¤åˆ¶å®Œæˆ ä¹‹åï¼Œå“ˆå¸Œæ¡¶ä¸­çš„å…ƒç´  è¢«é€†åºæ’åˆ—åˆ° æ–°è¡¨ä¸­
void resize(int newCapacity) {
    Entry[] newTable = new Entry[newCapacity];

    // æ³¨ï¼šJDK8ä¸­ ç§»é™¤äº†è®¡ç®—hashSeedçš„æ­¥éª¤ - å› ä¸ºå®ƒ ä¼šè°ƒç”¨Random.nextInt(),è€Œè¿™ä¸ªæ–¹æ³• å­˜åœ¨æ€§èƒ½é—®é¢˜
    transfer(newTable, initHashSeedAsNeeded(newCapacity));
    // æŠŠ æ–°è¡¨å¯¹è±¡ ç»‘å®šåˆ° tableå˜é‡ä¸Š
    // ğŸ– åœ¨ è¿™ä¸ªæ­¥éª¤ å®Œæˆä¹‹å‰ï¼Œæ—§è¡¨ä¸Š ä»æ—§èƒ½å¤Ÿ è¿›è¡Œå…ƒç´ çš„æ·»åŠ æ“ä½œã€‚ è¿™å¯èƒ½ä¼šå¯¼è‡´ æ—§è¡¨ä¸Š æ–°æ·»åŠ çš„å…ƒç´  ä¸¢å¤±
    table = newTable;
    // MAXæ˜¯ 1<<30
    threshold = (init)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + 1);
}

// ä»æ—§è¡¨ä¸­ è¿ç§»æ•°æ® åˆ°æ–°è¡¨ä¸­
void transfer(Entry[] newTable, boolean refresh ) {
    // å¤–éƒ¨å‚æ•° ä¼ å…¥æ—¶ï¼ŒæŒ‡å®š æ–°è¡¨çš„å¤§å° ä¸ºï¼š oldTable.length * 2
    int newCapacity = newTable.length;
    // éå† å“ˆå¸Œè¡¨
    for(Entry<K, V> e : table) {
        while(null != e) {
            Entry<K, V> next = e.next;

            // æŠŠ å½“å‰å…ƒç´  æ”¾åœ¨å“ˆå¸Œæ§½ä¸­ï¼Œè€Œä¸æ˜¯ æ”¾åœ¨é“¾è¡¨çš„æœ€å
            if(refresh) {
                e.hash = ((null == e.key) ? 0 : hash(e.key));
            }
            int i = indexFor(e.hash, newCapacity);

            // æŠŠ åŸæ¥slotä¸Šçš„å…ƒç´  ä½œä¸º å½“å‰å…ƒç´ çš„ä¸‹ä¸€ä¸ª
            e.next = newTable[i];
            // æ–°è¿ç§»è¿‡æ¥çš„èŠ‚ç‚¹ ç›´æ¥æ”¾åœ¨ å“ˆå¸Œæ§½ä¸Š
            newTable[i] = e;

            // ç»§ç»­ å‘ä¸‹éå†é“¾è¡¨
            e = next;
        }
    }
}

ä»£ç å¯èƒ½å¼•å‘çš„é—®é¢˜ï¼š
#1: æ•°æ®è¿ç§»æ—¶,ä¸¢å¤± æ–°æ·»åŠ çš„å…ƒç´ ï¼š - for(Entry<K, V> e : table) {...}
    â‘  çº¿ç¨‹A æ‰§è¡Œtransfer()ï¼Œç„¶å ç”±äº CPUæ—¶é—´ç‰‡ç”¨å°½ è€Œè¢«æŒ‚èµ·ï¼›
    â‘¡ çº¿ç¨‹B æ‰§è¡Œput()æ–¹æ³• {addEntry, createEntry}ï¼Œå¹¶ æˆåŠŸæ·»åŠ å…ƒç´ åˆ° å“ˆå¸Œè¡¨ä¸­çš„æŸä¸ªå“ˆå¸Œæ§½ - è¿™ä¸ªå“ˆå¸Œæ§½ åœ¨#1ä¸­å¯èƒ½ å·²ç»è¢«éå†è¿‡äº†
    â‘¢ çº¿ç¨‹A é‡æ–°è·å–åˆ° CPUæ—¶é—´ç‰‡ï¼Œç»§ç»­æ‰§è¡Œtransfer()æ–¹æ³• -> è¿™æ · çº¿ç¨‹Bæ–°å¢çš„entry å°±æ— æ³•è¢«è¿ç§»åˆ° newTable ä¸­

p2: å¤šä¸ªçº¿ç¨‹ åŒæ—¶æ‰§è¡Œ resize()æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç° çº¿ç¨‹ä¹‹é—´æ“ä½œçš„ ç›¸äº’è¦†ç›–
    â‘  æ¯ä¸ªçº¿ç¨‹ åœ¨æ‰§è¡Œresize()çš„æ—¶å€™ï¼Œéƒ½ä¼šï¼šåˆ›å»ºä¸€ä¸ª å±äºè‡ªå·±çš„æ•°ç»„å¯¹è±¡ - Entry[] newTable = new Entry[newCapacity];
    â‘¡ ä½†æ˜¯åœ¨ æ›´æ–°table æ—¶ï¼Œä½¿ç”¨çš„å´æ˜¯ çº¿ç¨‹ä¹‹é—´å…±äº«çš„å˜é‡ - table = newTable; // tableæ˜¯ çº¿ç¨‹å…±äº«å˜é‡,è€Œ newTable å´æ˜¯ å±€éƒ¨å˜é‡
    -> å¤šçº¿ç¨‹æ¡ä»¶ä¸‹ï¼Œæ‰§è¡Œresize()æ—¶ï¼Œä¼šå‡ºç° çº¿ç¨‹æ“ä½œä¹‹é—´çš„è¦†ç›–ã€‚


