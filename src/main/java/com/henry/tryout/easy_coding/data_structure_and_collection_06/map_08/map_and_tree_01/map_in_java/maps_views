Mapçš„keys, values,entrySetæ–¹æ³• è¿”å›çš„æ˜¯è§†å›¾å—ï¼Ÿå®ƒæœ‰ä»€ä¹ˆç‰¹å¾ï¼Ÿ

===
æ˜¯çš„ï¼åœ¨ Java çš„ Map æ¥å£ä¸­ï¼ˆå¦‚ HashMapã€TreeMapã€LinkedHashMap ç­‰ï¼‰ï¼ŒkeySet()ã€values() å’Œ entrySet() æ–¹æ³•è¿”å›çš„éƒ½æ˜¯â€œè§†å›¾ï¼ˆViewï¼‰â€ï¼Œè€Œä¸æ˜¯ç‹¬ç«‹çš„å‰¯æœ¬ã€‚

è¿™äº›è§†å›¾ å…·æœ‰ éå¸¸é‡è¦çš„ç‰¹æ€§ï¼Œç†è§£å®ƒä»¬ å¯¹ é¿å… bug å’Œ å†™å‡ºé«˜æ•ˆä»£ç  è‡³å…³é‡è¦ã€‚

âœ… ä¸€ã€ä»€ä¹ˆæ˜¯â€œè§†å›¾â€ï¼Ÿï¼ˆå›é¡¾ï¼‰
è§†å›¾ = å¯¹ åŸMapæ•°æ®çš„åŠ¨æ€çª—å£
    â‘  ä¸å¤åˆ¶æ•°æ®ï¼Œç›´æ¥åæ˜ åŸ Map çš„å½“å‰çŠ¶æ€
    â‘¡ ä¿®æ”¹è§†å›¾ â‡„ ä¿®æ”¹åŸ Map
    â‘¢ ä¿®æ”¹åŸ Map â‡„ è§†å›¾å†…å®¹è‡ªåŠ¨æ›´æ–°
è¿™å’Œ List.subList() çš„è¡Œä¸ºç±»ä¼¼ã€‚

===
âœ… äºŒã€ä¸‰ä¸ªè§†å›¾æ–¹æ³•è¯¦è§£
æ–¹æ³•	        |   è¿”å›ç±»å‹             |	è¯´æ˜
keySet()	|   Set<K>              | æ‰€æœ‰é”®çš„è§†å›¾
values()	| Collection<V>         | æ‰€æœ‰å€¼çš„è§†å›¾ï¼ˆæ³¨æ„ï¼šä¸æ˜¯ Setï¼Œå…è®¸é‡å¤ï¼‰
entrySet()	| Set<Map.Entry<K, V>>	| æ‰€æœ‰é”®å€¼å¯¹çš„è§†å›¾ï¼ˆæœ€å¸¸ç”¨ã€åŠŸèƒ½æœ€å¼ºï¼‰

===
âœ… ä¸‰ã€æ ¸å¿ƒç‰¹å¾ï¼ˆå…±æ€§ï¼‰
â‘ . ä¸åŸ Map åŒå‘åŒæ­¥

    Map<String, Integer> map = new HashMap<>();
    map.put("A", 1);
    map.put("B", 2);

    Set<String> keys = map.keySet();
    Collection<Integer> vals = map.values();
    Set<Map.Entry<String, Integer>> entries = map.entrySet();

    // é€šè¿‡è§†å›¾ä¿®æ”¹ â†’ å½±å“åŸ Map
    keys.remove("A");
    System.out.println(map); // {B=2}

    // é€šè¿‡åŸ Map ä¿®æ”¹ â†’ è§†å›¾è‡ªåŠ¨æ›´æ–°
    map.put("C", 3);
    System.out.println(keys);    // [B, C]
    System.out.println(vals);    // [2, 3]

â‘¡. æ”¯æŒç»“æ„ä¿®æ”¹ï¼ˆä½†æœ‰é™åˆ¶ï¼‰
    keySet().remove(key) â†’ ç›¸å½“äº map.remove(key)
    entrySet().iterator().remove() â†’ å®‰å…¨åˆ é™¤ï¼ˆæ¨èæ–¹å¼ï¼‰
    values().remove(value) â†’ åˆ é™¤ ç¬¬ä¸€ä¸ªåŒ¹é…çš„å€¼ï¼ˆæ³¨æ„ï¼šå¯èƒ½ä¸ç²¾ç¡®ï¼‰
âš ï¸ ä½† ä¸èƒ½é€šè¿‡ values() æ·»åŠ å…ƒç´ ï¼ˆå› ä¸ºæ— æ³•ç¡®å®š keyï¼‰ï¼š
    vals.add(99); // âŒ UnsupportedOperationException!

â‘¢. fail-fast æœºåˆ¶
å¦‚æœç›´æ¥é€šè¿‡ åŸMapä¿®æ”¹ç»“æ„ï¼ˆå¦‚ map.put()ã€map.clear()ï¼‰ï¼Œè€Œæ­¤æ—¶ æ­£åœ¨éå†è§†å›¾ï¼Œä¼šæŠ›å‡º ConcurrentModificationExceptionã€‚
ä½† é€šè¿‡è§†å›¾æœ¬èº«ä¿®æ”¹ï¼ˆå¦‚ keys.remove()ï¼‰æ˜¯å®‰å…¨çš„ï¼ˆå†…éƒ¨åè°ƒäº† modCountï¼‰ã€‚

    Set<String> keys = map.keySet();
    Iterator<String> it = keys.iterator();
    map.put("D", 4);      // âŒ å¤–éƒ¨ä¿®æ”¹
    it.next();            // â†’ ConcurrentModificationException

â‘£. è½»é‡çº§ï¼ˆO(1) åˆ›å»ºï¼‰
åˆ›å»ºè§†å›¾çš„ æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦ éƒ½æ˜¯ O(1)ï¼Œå› ä¸º ä¸å¤åˆ¶æ•°æ®ã€‚
è§†å›¾å¯¹è±¡ å†…éƒ¨æŒæœ‰ å¯¹åŸMapçš„å¼•ç”¨ã€‚

===
âœ… å››ã€å„è§†å›¾çš„ç‹¬ç‰¹è¡Œä¸º
ğŸ”¹ keySet()
â‘  æ˜¯ä¸€ä¸ª Setï¼Œæ‰€ä»¥æ— é‡å¤ã€æ— åºï¼ˆé™¤éç”¨ LinkedHashMap æˆ– TreeMapï¼‰
â‘¡ æ”¯æŒ remove()ã€contains()ã€size() ç­‰
â‘¢ ä¸èƒ½æ·»åŠ å…ƒç´ ï¼ˆå› ä¸º Map éœ€è¦ valueï¼‰ï¼š
    keys.add("X"); // âŒ UnsupportedOperationException

ğŸ”¹ values()
â‘  æ˜¯ä¸€ä¸ª Collectionï¼ˆä¸æ˜¯ Setï¼‰ï¼Œå…è®¸é‡å¤å€¼
â‘¡ ä¸èƒ½æ·»åŠ æˆ–è®¾ç½®å…ƒç´ ï¼ˆæ²¡æœ‰ key æ— æ³•æ’å…¥ï¼‰ï¼š
    vals.add(100);   // âŒ UnsupportedOperationException
    vals.clear();    // âœ… å¯ä»¥æ¸…ç©ºï¼ˆç›¸å½“äº map.clear()ï¼‰

ğŸ”¹ entrySet()ï¼ˆæœ€å¼ºå¤§ï¼ï¼‰
â‘  æ¯ä¸ª Map.Entry æ˜¯é”®å€¼å¯¹çš„å®æ—¶å¼•ç”¨
â‘¡ å¯ä»¥é€šè¿‡ entry.setValue(newValue) ä¿®æ”¹ valueï¼ˆè¿™æ˜¯å”¯ä¸€èƒ½ é€šè¿‡è§†å›¾ä¿®æ”¹value çš„æ–¹å¼ï¼ï¼‰
â‘¢ æ”¯æŒ å®Œæ•´çš„å¢åˆ æŸ¥ï¼ˆé€šè¿‡è¿­ä»£å™¨ï¼‰

    for (Map.Entry<String, Integer> entry : map.entrySet()) {
        if ("B".equals(entry.getKey())) {
            entry.setValue(999); // âœ… ç›´æ¥ä¿®æ”¹åŸ Map çš„ valueï¼
        }
    }
    System.out.println(map); // {B=999, C=3}
ğŸ’¡ è¿™æ˜¯é«˜æ•ˆæ›´æ–° Map å€¼çš„æ¨èæ–¹å¼ï¼

===
âœ… äº”ã€å¸¸è§é™·é˜±ä¸æœ€ä½³å®è·µ
âŒ é™·é˜± 1ï¼šè¯¯ä»¥ä¸ºæ˜¯å‰¯æœ¬

    Map<String, Integer> original = new HashMap<>();
    original.put("x", 1);
    List<String> keyList = new ArrayList<>(original.keySet()); // âŒ å¦‚æœä½ æƒ³è¦å‰¯æœ¬ï¼Œå¿…é¡»è¿™æ ·åŒ…ä¸€å±‚ï¼
    // å¦åˆ™ç›´æ¥ç”¨ keySet() å°±æ˜¯è§†å›¾ï¼

âŒ é™·é˜± 2ï¼šå¤šçº¿ç¨‹ä¸‹ä¸å®‰å…¨
å³ä½¿åŸ Map æ˜¯ Collections.synchronizedMap()ï¼Œå…¶è§†å›¾ ä¹Ÿä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼
å¿…é¡»æ‰‹åŠ¨åŒæ­¥ï¼š

    Map<String, Integer> syncMap = Collections.synchronizedMap(new HashMap<>());
    // éå†æ—¶ä»éœ€åŒæ­¥
    synchronized (syncMap) {
        for (String key : syncMap.keySet()) {
            // ...
        }
    }

===
âœ… æœ€ä½³å®è·µ
â‘  éå† Map æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨ entrySet()ï¼ˆé¿å…å¤šæ¬¡è°ƒç”¨ get()ï¼‰

    // å¥½
    for (Map.Entry<K, V> e : map.entrySet()) { ... }

    // å·®ï¼ˆæ¯æ¬¡ get éƒ½æœ‰å“ˆå¸Œè®¡ç®—å¼€é”€ï¼‰
    for (K key : map.keySet()) {
        V value = map.get(key);
    }

â‘¡ éœ€è¦ç‹¬ç«‹å‰¯æœ¬æ—¶ï¼Œæ˜¾å¼å¤åˆ¶ï¼š

    Set<K> independentKeys = new HashSet<>(map.keySet());
    List<V> independentValues = new ArrayList<>(map.values());

===
âœ… å…­ã€æ€»ç»“
ç‰¹æ€§	            |   è¯´æ˜
æ˜¯å¦è§†å›¾	        | âœ… æ˜¯ï¼ä¸åŸ Map åŒå‘åŒæ­¥
æ˜¯å¦å¯ä¿®æ”¹	    | âœ… å¯åˆ é™¤ï¼›entrySet å¯æ”¹ valueï¼›ä½†éƒ½ä¸èƒ½æ–°å¢ï¼ˆé™¤ entrySet è¿­ä»£å™¨å¤–ï¼‰
æ˜¯å¦ fail-fast	| âœ… æ˜¯ï¼ˆå¤–éƒ¨ä¿®æ”¹ä¼šæŠ›å¼‚å¸¸ï¼‰
å†…å­˜å ç”¨	        | æä½ï¼ˆåªå­˜å¼•ç”¨ï¼‰
çº¿ç¨‹å®‰å…¨	        | âŒ å¦ï¼ˆå³ä½¿åŸ Map åŒæ­¥ï¼Œè§†å›¾ä¹Ÿä¸è‡ªåŠ¨åŒæ­¥ï¼‰
æ¨èç”¨é€”	        | éå†ã€æ‰¹é‡åˆ é™¤ã€åŠ¨æ€è§‚å¯Ÿ Map çŠ¶æ€

ğŸ’ è®°ä½ï¼š
keySet() / values() / entrySet() æ˜¯ Map çš„â€œæ´»çª—å£â€ï¼Œä¸æ˜¯å¿«ç…§ã€‚

ç”¨å¾—å¥½ï¼Œé«˜æ•ˆåˆç®€æ´ï¼›ç”¨ä¸å¥½ï¼Œbug éš¾æ’æŸ¥ã€‚