åœ¨ Servletä¸­ï¼Œä»¥HTMLç™»å½•è¡¨å•çš„æ–¹å¼ æ‰§è¡Œ å¯¹userçš„è®¤è¯ï¼š

æ‰©å±•è‡ª SecurityFilterChainçš„å›¾è¡¨
--- userè¢«é‡å®šå‘åˆ°ç™»å½•è¡¨å• ---
#1 user å‘ä¸€ä¸ªä»–æ²¡æœ‰è¢«æˆæƒçš„èµ„æº å‘é€ä¸€ä¸ªæœªè¢«è®¤è¯çš„è¯·æ±‚ï¼›
#2 Securityçš„ FilterSecurityInterceptorï¼ˆæ‹¦æˆªå™¨ï¼‰ é€šè¿‡æŠ›å‡ºä¸€ä¸ª AccessDeniedException æ¥ è¡¨ç¤º æœªè®¤è¯çš„è¯·æ±‚è¢«æ‹’ç»äº†ï¼›
#3 ç”±äº userè¿˜æ²¡æœ‰è¢«è®¤è¯ï¼Œ å› æ­¤ï¼š ExceptionTransactionFilter ä¼š å¼€å§‹è®¤è¯ å¹¶ ä½¿ç”¨ AuthenticationEntryPoint å‘é€ä¸€ä¸ª åˆ°ç™»å½•é¡µçš„é‡å®šå‘ï¼›
    ğŸ– å¤šæ•°æƒ…å†µä¸‹ï¼Œ AuthenticationEntryPoint æ˜¯ä¸€ä¸ª LoginUrlAuthenticationEntryPointçš„å®ä¾‹ï¼›
#4 æµè§ˆå™¨æŒ‰ç…§é‡å®šå‘çš„æŒ‡ç¤ºï¼Œæ¥è¯·æ±‚ç™»å½•é¡µï¼›
#5 åº”ç”¨ç¨‹åºçš„æŸä¸ªéƒ¨åˆ† ä¼šæ¸²æŸ“ç™»å½•é¡µã€‚

--- useré€šè¿‡ç™»å½•è¡¨å•æä¾›äº†è‡ªå·±çš„username ä¸ å¯†ç  ---
#1 UsernamePasswordAuthenticationFilterï¼ˆç»§æ‰¿è‡ª AAPF å‚è€ƒï¼šworkflow_of_AbstractAuthenticationProcessingFilterï¼‰
    æ ¹æ® HttpRequest æ¥ åˆ›å»ºå‡º tokenå¯¹è±¡ï¼ˆAuthenticationå®ä¾‹ï¼‰ï¼›
#2 æŠŠ #1ä¸­çš„tokenå¯¹è±¡ ä¼ å…¥åˆ° AuthenticationManagerä¸­ï¼›
    ğŸ– å…·ä½“ä¼šä½¿ç”¨ AuthenticationManagerçš„å®ç°ç±» å–å†³äº userä¿¡æ¯çš„å­˜å‚¨æ–¹å¼ï¼›
#3 å¦‚æœè®¤è¯å¤±è´¥ï¼Œåˆ™ï¼š{123}
#4 å¦‚æœè®¤è¯æˆåŠŸï¼Œåˆ™ï¼š{12345}

======
ç”¨æ³•ï¼ˆå¼€å‘è€…ï¼‰ï¼š
#1 ä¸€æ—¦æä¾›äº†ä»»ä½• åŸºäºservletçš„é…ç½®ï¼Œåˆ™ï¼šå¼€å‘è€…å°±å¿…éœ€æ˜¾å¼æä¾› åŸºäºè¡¨å•çš„ç™»å½•ï¼›
æœ€ç®€é…ç½®ä»£ç ï¼š
public SecurityFilterChain filterChain(HttpSecurity http) {
	http
		.formLogin(withDefaults());
	// ...
}

#2 é…ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„ç™»é™†é¡µé¢ï¼›
2-1 é…ç½® è‡ªå®šä¹‰çš„ç™»å½•è¡¨å•
public SecurityFilterChain filterChain(HttpSecurity http) {
	http
		.formLogin(form -> form
			.loginPage("/login")
			.permitAll()
		);
	// ...
}

2-2 ç¼–å†™é¡µé¢æ¨¡æ¿ï¼ˆThymeleafï¼‰
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org">
	<head>
		<title>Please Log In</title>
	</head>
	<body>
		<h1>Please Log In</h1>
		<div th:if="${param.error}">
			Invalid username and password.</div>
		<div th:if="${param.logout}">
			You have been logged out.</div>
		<form th:action="@{/login}" method="post">
			<div>
			<input type="text" name="username" placeholder="Username"/>
			</div>
			<div>
			<input type="password" name="password" placeholder="Password"/>
			</div>
			<input type="submit" value="Log in" />
		</form>
	</body>
</html>

2-3 é…ç½® è¯·æ±‚ /login -> ç™»å½•è¡¨å•æ¨¡æ¿çš„æ˜ å°„ã€ä½¿ç”¨ SpringMVCæ—¶ã€‘ï¼š
@Controller
class LoginController {
	@GetMapping("/login")
	String login() {
		return "login";
	}
}
